<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BondLog</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  </head>
<body>
  <header class="app-header bg-brand-teal">
    <div class="header-left">
      <h1 id="app-title" tabindex="0" role="button">BondLog</h1>
    </div>
    <div class="header-right">
      <button id="menu-button">☰</button>
    </div>
    <div id="menu">
      <button id="export-btn">💾 エクスポート</button>
      <button id="import-btn">📂 インポート</button>
      <button id="reset-btn">🗑️ データ初期化</button>
    </div>
  </header>

  <nav class="page-nav">
    <div class="page-nav__inner">
      <button class="tab-btn active" data-page-target="dashboard" aria-selected="true">
        <span class="tab-btn__icon">🏠</span>
        <span class="tab-btn__label">
          <span class="tab-btn__label--short">ダッシュボード</span>
          <span class="tab-btn__label--full">ダッシュボード</span>
        </span>
      </button>
      <button class="tab-btn" data-page-target="platform" aria-selected="false">
        <span class="tab-btn__icon">📺</span>
        <span class="tab-btn__label">
          <span class="tab-btn__label--short">プラットフォーム</span>
          <span class="tab-btn__label--full">プラットフォーム</span>
        </span>
      </button>
      <button class="tab-btn" data-page-target="listener" aria-selected="false">
        <span class="tab-btn__icon">👤</span>
        <span class="tab-btn__label">
          <span class="tab-btn__label--short">リスナー</span>
          <span class="tab-btn__label--full">リスナー</span>
        </span>
      </button>
      <button class="tab-btn" data-page-target="status" aria-selected="false">
        <span class="tab-btn__icon">🏷️</span>
        <span class="tab-btn__label">
          <span class="tab-btn__label--short">ステータス</span>
          <span class="tab-btn__label--full">ステータス管理</span>
        </span>
      </button>
    </div>
  </nav>

  <main id="app-main">
    <!-- ダッシュボード -->
    <section id="dashboard-view" class="view active">
      <section class="home-hero" aria-label="BondLogの概要">
        <p>BondLogは、配信者とリスナーの絆(Bond)を記録(Log)するアプリです。</p>
        <p>プラットフォームごとに配信と参加してくれたリスナーを記録できます。</p>
        <p>
          <strong>プライバシー保護:</strong> 
          サーバーにデータを送信せず、すべてお使いの端末内にのみ保存されます。
          <br>
          ※ 公共の端末(ネットカフェなど)でのご利用にはご注意ください。
        </p>
        <p>
          <strong>初めての方へ:</strong>
          まずは<a href="sample-data.json" download>サンプルデータ</a>をダウンロードし、
          右上のメニューから「📂 インポート」を選んで読み込むと、すぐに各機能をお試しいただけます。
          <br>
          試用後、ご自身のデータを登録する際は、メニューから「🗑️ データ初期化」を選択してください。
        </p>
        <p>
          <a href="UserGuide.html" target="_blank" rel="noopener noreferrer">📖 使い方ガイドを見る</a>
        </p>
      </section>

      <section class="home-section" id="home-profiles">
        <div class="home-section-header">
          <h2 class="home-section-title">プラットフォーム</h2>
          <button class="secondary" id="dashboard-view-all-platforms">すべて見る</button>
        </div>
        <p id="dashboard-profile-empty" class="empty-state">まだプラットフォームが登録されていません</p>
        <ul class="list" id="dashboard-profile-list"></ul>
      </section>

      <section class="home-section" id="home-listeners">
        <div class="home-section-header">
          <h2 class="home-section-title">リスナー</h2>
          <button class="secondary" id="dashboard-view-all-listeners">すべて見る</button>
        </div>
        <p id="dashboard-listener-empty" class="empty-state">まだリスナーが登録されていません</p>
        <ul class="list" id="dashboard-listener-list"></ul>
      </section>

      <section class="home-section" id="home-follower-charts">
        <div class="home-section-header">
          <h2 class="home-section-title">登録者数の推移</h2>
          <div class="chart-controls">
            <label for="chart-duration-filter" style="font-size: 0.9rem; margin-right: 0.5rem;">期間:</label>
            <select id="chart-duration-filter" style="padding: 0.2rem;">
              <option value="all">すべて</option>
              <option value="365">過去1年</option>
              <option value="180">過去6ヶ月</option>
              <option value="90">過去3ヶ月</option>
              <option value="30">過去1ヶ月</option>
            </select>
          </div>
        </div>

        <div id="dashboard-follower-charts-container">
          <p id="follower-charts-empty" class="empty-state">まだ登録者履歴を持つプラットフォームがありません</p>
        </div>
      </section>
    </section>

    <!-- プラットフォーム一覧 -->
    <section id="platform-list-view" class="view">
      <button class="back-btn" id="back-to-dashboard-from-platform">← ダッシュボードへ戻る</button>
      <div class="platform-list-header">
        <div class="platform-list-header-top">
          <h2>プラットフォーム一覧</h2>
          <button class="secondary" id="add-platform-btn">＋ プラットフォームを追加</button>
        </div>
        <div class="list-toolbar">
          <label for="platform-sort">表示順</label>
          <select id="platform-sort">
            <option value="name-asc">名前（昇順）</option>
            <option value="name-desc">名前（降順）</option>
          </select>
        </div>
      </div>
      <p id="platform-empty" class="empty-state">まだプラットフォームが登録されていません</p>
      <ul class="list" id="platform-list"></ul>
    </section>

    <!-- リスナー一覧 -->
    <section id="listener-list-view" class="view">
      <button class="back-btn" id="back-to-dashboard-from-listener">← ダッシュボードへ戻る</button>
      <div class="listener-list-header">
        <div class="listener-list-header-top">
          <h2>リスナー一覧</h2>
          <button class="secondary" id="add-listener-btn">＋ リスナーを追加</button>
        </div>
        <div class="list-toolbar">
          <label for="listener-sort">表示順</label>
          <select id="listener-sort">
            <option value="name-asc">名前（昇順）</option>
            <option value="name-desc">名前（降順）</option>
            <option value="last-attended-desc">最終参加日時（新しい順）</option>
            <option value="last-attended-asc">最終参加日時（古い順）</option>
          </select>
        </div>
      </div>
      <p id="listener-empty" class="empty-state">まだリスナーが登録されていません</p>
      <ul class="list" id="listener-list"></ul>
    </section>

    <!-- プラットフォーム詳細 -->
    <section id="profile-detail-view" class="view">
      <button class="back-btn" id="back-to-profiles">← プラットフォームへ戻る</button>
      <div class="profile-header">
        <h2 id="profile-title"></h2>
      </div>

      <div class="local-nav">
        <button class="local-tab-btn active" data-tab="streams">📺 配信一覧</button>
        <button class="local-tab-btn" data-tab="history">📈 登録者推移</button>
      </div>

      <div id="tab-content-streams" class="local-tab-content active">
        <div class="stream-list-header">
          <button class="secondary" id="add-stream">＋ 配信を追加</button>
          <input type="text" id="stream-search" placeholder="タイトルで検索" />
        </div>
        <ul class="list" id="stream-list"></ul>
      </div>

      <div id="tab-content-history" class="local-tab-content">
        <div class="history-summary">
          <div class="summary-current">
            <span class="summary-label">現在の登録者数:</span>
            <span class="summary-value" id="current-follower-count">-</span>
          </div>
          <div class="summary-diff">
            <span class="summary-label">前回比:</span>
            <span class="summary-value" id="follower-diff">-</span>
          </div>
        </div>
        <button class="secondary" id="add-follower-history">＋ 履歴を記録</button>
        <ul class="list" id="follower-history-list"></ul>
      </div>
    </section>

    <!-- ステータス一覧 -->
    <section id="status-list-view" class="view">
      <button class="back-btn" id="back-to-dashboard-from-status">← ダッシュボードへ戻る</button>
      <div class="status-list-header">
        <div class="status-list-header-top">
          <h2>ステータス一覧</h2>
          <button class="secondary" id="status-add-btn">＋ ステータスを追加</button>
        </div>
        <div class="list-toolbar">
          <label for="status-filter-state">表示対象</label>
          <select id="status-filter-state">
            <option value="active">アクティブのみ</option>
            <option value="archived">アーカイブのみ</option>
            <option value="all">全件</option>
          </select>
        </div>
      </div>
      <p id="status-empty" class="empty-state">ステータスが登録されていません</p>
      <ul class="list status-list" id="status-list"></ul>
    </section>

    <!-- ステータス詳細 -->
    <section id="status-detail-view" class="view">
      <button class="back-btn" id="back-to-status-list">← ステータス一覧へ戻る</button>
      <h2>ステータス詳細</h2>
      <p id="status-detail-empty" class="empty-state">ステータスを選択するか、新規作成してください</p>
      <form id="status-editor-form" class="status-editor" novalidate>
        <input type="hidden" id="status-id" />
        <div class="form-field">
          <label for="status-displayName">表示名</label>
          <input type="text" id="status-displayName" autocomplete="off" />
        </div>
        <div class="form-field">
          <label for="status-description">説明</label>
          <textarea id="status-description"></textarea>
        </div>
        <div class="form-field">
          <label for="status-displayPriority">表示優先度（数値。大きいほど先頭）</label>
          <input type="number" id="status-displayPriority" />
        </div>
        <p id="status-usage-info" class="status-usage-info"></p>
        <div class="status-editor-actions">
          <button type="button" class="secondary" id="status-archive-toggle-btn">アーカイブへ移動</button>
          <button type="submit" class="primary" id="status-save-btn">保存</button>
          <button type="button" class="danger-btn" id="status-delete-btn">完全削除</button>
        </div>
        <div class="button-description">
          <p class="description-text">アーカイブ: データは残りますが、新規付与できなくなります</p>
          <p class="warning-text">⚠️完全削除: 過去の付与履歴も含めてすべて削除されます</p>
        </div>
      </form>
    </section>

    <!-- リスナー詳細 -->
    <section id="listener-detail-view" class="view">
  <button class="back-btn" id="back-to-listeners">← リスナーへ戻る</button>

      <div class="listener-header">
        <div class="listener-heading">
          <div class="listener-heading-top">
            <h2 id="listener-name"></h2>
            <div id="listener-statuses" class="status-badge-container status-badge-container--compact"></div>
          </div>
          <span id="listener-profile"></span>
        </div>
        <div id="listener-tags" class="tag-container"></div>
      </div>

      <section class="listener-section">
        <div class="section-title">
          <h3>基本情報</h3>
          <button id="listener-edit" class="secondary">編集</button>
        </div>
        <dl class="listener-info">
          <div>
            <dt>リスナー名</dt>
            <dd id="listener-name-static"></dd>
          </div>
          <div>
            <dt>URL</dt>
            <dd id="listener-urls"></dd>
          </div>
          <div>
            <dt>現在のステータス</dt>
            <dd class="listener-status-block">
              <div id="listener-status-current"></div>
              <div id="listener-status-detail" class="status-detail"></div>
              <div class="listener-status-actions">
                <button id="listener-status-manage" class="secondary listener-status-manage-btn">ステータスを管理</button>
                <button id="listener-status-history" class="secondary listener-status-history-btn">履歴を見る</button>
              </div>
            </dd>
          </div>
          <div>
            <dt>メモ</dt>
            <dd id="listener-memo"></dd>
          </div>
        </dl>
      </section>

      <section class="listener-section">
        <div class="section-title">
          <h3>参加履歴</h3>
        </div>
        <p id="listener-attendance-empty" class="empty-state">まだ記録がありません</p>
        <ul class="list" id="listener-attendance-list"></ul>
      </section>

      <section class="listener-section">
        <div class="section-title">
          <h3>ギフト履歴</h3>
          <div class="gift-summary" id="listener-gift-summary"></div>
        </div>
        <p id="listener-gift-empty" class="empty-state">まだ記録がありません</p>
        <ul class="list" id="listener-gift-list"></ul>
      </section>
    </section>

    <!-- 配信詳細 -->
    <section id="stream-detail-view" class="view">
      <button class="back-btn" id="back-to-profile">← 配信一覧へ戻る</button>
      <h2 id="stream-title"></h2>
      <p id="stream-schedule" class="stream-meta"></p>
      <p id="stream-url" class="stream-meta"></p>

      <div class="section-header">
        <h3>参加リスナー</h3>
        <button class="secondary" id="add-attendee">＋ 参加者を追加</button>
      </div>
      <ul class="list" id="attendee-list"></ul>

      <div class="section-header">
        <h3>ギフト履歴</h3>
        <button class="secondary" id="add-gift">＋ ギフトを追加</button>
      </div>
      <ul class="list" id="gift-list"></ul>
    </section>
  </main>

  <div id="modal-bg">
    <div id="modal">
      <div class="modal-header">
        <h3 id="modal-title">追加</h3>
        <div id="modal-header-actions"></div>
      </div>
      <div id="modal-body"></div>
      <button id="modal-cancel">キャンセル</button>
      <button id="modal-ok" class="primary">OK</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
